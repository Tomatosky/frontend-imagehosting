/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version 4.2.3
 *
 * File input styled for Bootstrap 3.0 that utilizes HTML5 File Input's advanced 
 * features including the FileReader API. 
 * 
 * The plugin drastically enhances the HTML file input to preview multiple files on the client before
 * upload. In addition it provides the ability to preview content of images, text, videos, audio, html, 
 * flash and other objects. It also offers the ability to upload and delete files using AJAX, and add 
 * files in batches (i.e. preview, append, or remove before upload).
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(A){A.fn.fileinputLocales={};String.prototype.repl=function(V,U){return this.split(V).join(U)};var i=function(U){var W=document.createElement("div"),V;W.innerHTML="<!--[if IE "+U+"]><i></i><![endif]-->";V=(W.getElementsByTagName("i").length===1);document.body.appendChild(W);W.parentNode.removeChild(W);return V},l={data:{},init:function(V){var U=V.initialPreview,W=V.id;if(U.length>0&&!t(U)){U=U.split(V.initialPreviewDelimiter)}l.data[W]={content:U,config:V.initialPreviewConfig,tags:V.initialPreviewThumbTags,delimiter:V.initialPreviewDelimiter,template:V.previewGenericTemplate,msg:function(X){return V.getMsgSelected(X)},initId:V.previewInitId,footer:V.getLayoutTemplate("footer"),isDelete:V.initialPreviewShowDelete,caption:V.initialCaption,actions:function(X,ab,aa,Y,Z){return V.renderFileActions(X,ab,aa,Y,Z)}}},fetch:function(U){return l.data[U].content.filter(function(V){return V!==null})},count:function(V,U){return !!l.data[V]&&!!l.data[V].content?(U?l.data[V].content.length:l.fetch(V).length):0},get:function(V,aa,ac){var W="init_"+aa,Z=l.data[V],X=Z.config[aa],ab=Z.initId+"-"+W,Y,U,ae={},ad=" file-preview-initial";ac=ac===undefined?true:ac;if(Z.content[aa]===null){return""}if(!n(X)&&!n(X.frameClass)){ad+=" "+X.frameClass}Y=Z.template.repl("{previewId}",ab).repl("{frameClass}",ad).repl("{fileindex}",W).repl("{content}",Z.content[aa]).repl("{footer}",l.footer(V,aa,ac));if(Z.tags.length&&Z.tags[aa]){Y=d(Y,Z.tags[aa])}if(!n(X)&&!n(X.frameAttr)){U=A(document.createElement("div")).html(Y);U.find(".file-preview-initial").attr(X.frameAttr);Y=U.html();U.remove()}return Y},add:function(aa,Y,X,W,U){var Z=A.extend(true,{},l.data[aa]),V;if(!t(Y)){Y=Y.split(Z.delimiter)}if(U){V=Z.content.push(Y)-1;Z.config[V]=X;Z.tags[V]=W}else{V=Y.length;Z.content=Y;Z.config=X;Z.tags=W}l.data[aa]=Z;return V},set:function(aa,Y,W,V,U){var Z=A.extend(true,{},l.data[aa]),X;if(!t(Y)){Y=Y.split(Z.delimiter)}if(U){for(X=0;X<Y.length;X++){Z.content.push(Y[X])}for(X=0;X<W.length;X++){Z.config.push(W[X])}for(X=0;X<V.length;X++){Z.tags.push(V[X])}}else{Z.content=Y;Z.config=W;Z.tags=V}l.data[aa]=Z},unset:function(W,V){var U=l.count(W);if(!U){return}if(U===1){l.data[W].content=[];l.data[W].config=[];return}l.data[W].content[V]=null;l.data[W].config[V]=null},out:function(Z){var X="",Y=l.data[Z],V,U=l.count(Z,true);if(U===0){return{content:"",caption:""}}for(var W=0;W<U;W++){X+=l.get(Z,W)}V=Y.msg(l.count(Z));return{content:X,caption:V}},footer:function(V,ab,ae){var aa=l.data[V];ae=ae===undefined?true:ae;if(aa.config.length===0||n(aa.config[ab])){return""}var X=aa.config[ab],af=E("caption",X)?X.caption:"",W=E("width",X)?X.width:"auto",U=E("url",X)?X.url:false,ad=E("key",X)?X.key:null,Z=(U===false)&&ae,Y=aa.isDelete?aa.actions(false,true,Z,U,ad):"",ac=aa.footer.repl("{actions}",Y);return ac.repl("{caption}",af).repl("{width}",W).repl("{indicator}","").repl("{indicatorTitle}","")}},M=function(U,V){V=V||0;if(typeof U==="number"){return U}if(typeof U==="string"){U=parseFloat(U)}return isNaN(U)?V:U},s=function(){return window.File&&window.FileReader},Q=function(){var U=document.createElement("div");return !i(9)&&(U.draggable!==undefined||(U.ondragstart!==undefined&&U.ondrop!==undefined))},u=function(){return s()&&window.FormData},k=function(V,U){V.removeClass(U).addClass(U)},y='style="width:{width};height:{height};"',z='      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n',g='<div class="file-preview-other">\n       {previewFileIcon}\n   </div>',G={removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign file-icon-large text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},c='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {browse}\n   </div>\n</div>',b='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',w='<div class="file-preview {class}">\n    <div class="close fileinput-remove">&times;</div>\n    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',o='<span class="glyphicon glyphicon-file kv-caption-icon">单击图片复制链接  -----  </span>',L='<div tabindex="-1" class="form-control file-caption {class}">\n   <span class="file-caption-ellipsis">&hellip;</span>\n   <div class="file-caption-name"></div>\n</div>',S='<div id="{id}" class="modal fade">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h3 class="modal-title">Detailed Preview <small>{title}</small></h3>\n      </div>\n      <div class="modal-body">\n        <textarea class="form-control" style="font-family:Monaco,Consolas,monospace; height: {height}px;" readonly>{body}</textarea>\n      </div>\n    </div>\n  </div>\n</div>',r='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',T='<div class="file-thumbnail-footer">\n    <div class="file-caption-name" id="{caption}">{caption}</div>\n    {actions}\n</div>',J='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    </div>\n    <div class="file-upload-indicator" tabindex="-1" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',v='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}"{dataUrl}{dataKey}>{removeIcon}</button>\n',m='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n</button>\n',h='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n</div>\n',D='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object data="{data}" type="{type}" width="{width}" height="{height}">\n       '+g+"\n    </object>\n   {footer}\n</div>",I='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <textarea id="copy_temp"></textarea>   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" id="1-{previewId}" onclick="copyImagUrl(\'1-{previewId}\')"'+y+">\n   {footer}\n</div>\n",C='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <div class="file-preview-text" title="{caption}" '+y+">\n       {data}\n   </div>\n   {footer}\n</div>",H='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+y+'>\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       '+g+"\n   </video>\n   {footer}\n</div>\n",e='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+y+'>\n   <audio controls>\n       <source src="{data}" type="{type}">\n       '+g+"\n   </audio>\n   {footer}\n</div>",f='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+y+'>\n   <object type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+z+"       "+g+"\n   </object>\n   {footer}\n</div>\n",x='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+y+'>\n   <object data="{data}" type="{type}" width="{width}" height="{height}">\n       <param name="movie" value="{caption}" />\n'+z+"         "+g+"\n   </object>\n   {footer}\n</div>",B='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+y+">\n   "+g+"\n   {footer}\n</div>",a={main1:c,main2:b,preview:w,icon:o,caption:L,modal:S,progress:r,footer:T,actions:J,actionDelete:v,actionUpload:m},K={generic:h,html:D,image:I,text:C,video:H,audio:e,flash:f,object:x,other:B},N=["image","html","text","video","audio","flash","object"],R={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},O={image:function(V,U){return(V!==undefined)?V.match("image.*"):U.match(/\.(gif|png|jpe?g)$/i)},html:function(V,U){return(V!==undefined)?V==="text/html":U.match(/\.(htm|html)$/i)},text:function(V,U){return(V!==undefined&&V.match("text.*"))||U.match(/\.(txt|md|csv|nfo|php|ini)$/i)},video:function(V,U){return(V!==undefined&&V.match(/\.video\/(ogg|mp4|webm)$/i))||U.match(/\.(og?|mp4|webm)$/i)},audio:function(V,U){return(V!==undefined&&V.match(/\.audio\/(ogg|mp3|wav)$/i))||U.match(/\.(ogg|mp3|wav)$/i)},flash:function(V,U){return(V!==undefined&&V==="application/x-shockwave-flash")||U.match(/\.(swf)$/i)},object:function(){return true},other:function(){return true}},n=function(V,U){return V===null||V===undefined||V.length===0||(U&&A.trim(V)==="")},t=function(U){return Array.isArray(U)||Object.prototype.toString.call(U)==="[object Array]"},E=function(V,U){return(typeof U==="object"&&V in U)},F=function(U,W,V){return(n(U)||n(U[W]))?V:A(U[W])},q=function(){return Math.round(new Date().getTime()+(Math.random()*100))},p=function(U){return String(U).repl("&","&amp;").repl('"',"&quot;").repl("'","&#39;").repl("<","&lt;").repl(">","&gt;")},d=function(W,V){var U=W;V=V||{};A.each(V,function(X,Y){if(typeof Y==="function"){Y=Y()}U=U.repl(X,Y)});return U},P=window.URL||window.webkitURL,j=function(W,V){var U=this;U.$element=A(W);if(!U.validate()){return}U.isPreviewable=s();U.isIE9=i(9);U.isIE10=i(10);if(U.isPreviewable||U.isIE9){U.init(V);U.listen()}else{U.$element.removeClass("file-loading")}};j.prototype={constructor:j,validate:function(){var V=this,U;if(V.$element.attr("type")==="file"){return true}U='<div class="help-block alert alert-warning"><h4>Invalid Input Type</h4>You must set an input <code>type = file</code> for <b>bootstrap-fileinput</b> plugin to initialize.</div>';V.$element.after(U);return false},init:function(V){var U=this,X=U.$element,W;A.each(V,function(Y,Z){U[Y]=(Y==="maxFileCount"||Y==="maxFileSize")?M(Z):Z});U.fileInputCleared=false;U.fileBatchCompleted=true;if(n(U.allowedPreviewTypes)){U.allowedPreviewTypes=N}if(!U.isPreviewable){U.showPreview=false}U.uploadFileAttr=!n(X.attr("name"))?X.attr("name"):"file_data";U.reader=null;U.formdata={};U.filestack=[];U.ajaxRequests=[];U.isError=false;U.ajaxAborted=false;U.dropZoneEnabled=Q()&&U.dropZoneEnabled;U.isDisabled=U.$element.attr("disabled")||U.$element.attr("readonly");U.isUploadable=u()&&!n(U.uploadUrl);U.slug=typeof V.slugCallback==="function"?V.slugCallback:U.slugDefault;U.mainTemplate=U.showCaption?U.getLayoutTemplate("main1"):U.getLayoutTemplate("main2");U.captionTemplate=U.getLayoutTemplate("caption");U.previewGenericTemplate=U.getPreviewTemplate("generic");if(n(U.$element.attr("id"))){U.$element.attr("id",q())}if(U.$container===undefined){U.$container=U.createContainer()}else{U.refreshContainer()}U.$progress=U.$container.find(".kv-upload-progress");U.$btnUpload=U.$container.find(".kv-fileinput-upload");U.$captionContainer=F(V,"elCaptionContainer",U.$container.find(".file-caption"));U.$caption=F(V,"elCaptionText",U.$container.find(".file-caption-name"));U.$previewContainer=F(V,"elPreviewContainer",U.$container.find(".file-preview"));U.$preview=F(V,"elPreviewImage",U.$container.find(".file-preview-thumbnails"));U.$previewStatus=F(V,"elPreviewStatus",U.$container.find(".file-preview-status"));U.$errorContainer=F(V,"elErrorContainer",U.$previewContainer.find(".kv-fileinput-error"));if(!n(U.msgErrorClass)){k(U.$errorContainer,U.msgErrorClass)}U.$errorContainer.hide();U.fileActionSettings=A.extend(G,V.fileActionSettings);U.previewInitId="preview-"+q();U.id=U.$element.attr("id");l.init(U);U.initPreview(true);U.initPreviewDeletes();U.options=V;U.setFileDropZoneTitle();U.uploadCount=0;U.uploadPercent=0;U.$element.removeClass("file-loading");W=U.getLayoutTemplate("progress");U.progressTemplate=W.replace("{class}",U.progressClass);U.progressCompleteTemplate=W.replace("{class}",U.progressCompleteClass);U.setEllipsis()},parseError:function(X,Y,aa){var V=this,W=A.trim(Y+""),U=W.slice(-1)==="."?"":".",Z=X.responseJSON!==undefined&&X.responseJSON.error!==undefined?X.responseJSON.error:X.responseText;if(V.showAjaxErrorDetails){Z=A.trim(Z.replace(/\n\s*\n/g,"\n"));Z=Z.length>0?"<pre>"+Z+"</pre>":"";W+=U+Z}else{W+=U}return aa?"<b>"+aa+": </b>"+X:W},raise:function(V,X){var U=this,W=A.Event(V);if(X!==undefined){U.$element.trigger(W,X)}else{U.$element.trigger(W)}if(!W.result){return W.result}switch(V){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:U.ajaxAborted=W.result;break}return true},getLayoutTemplate:function(V){var U=this,W=E(V,U.layoutTemplates)?U.layoutTemplates[V]:a[V];if(n(U.customLayoutTags)){return W}return d(W,U.customLayoutTags)},getPreviewTemplate:function(V){var U=this,W=E(V,U.previewTemplates)?U.previewTemplates[V]:K[V];W=W.repl("{previewFileIcon}",U.previewFileIcon);if(n(U.customPreviewTags)){return W}return d(W,U.customPreviewTags)},getOutData:function(W,V,X){var U=this;W=W||{};V=V||{};X=X||U.filestack.slice(0)||{};return{form:U.formdata,files:X,extra:U.getExtraData(),response:V,reader:U.reader,jqXHR:W}},setEllipsis:function(){var V=this,W=V.$captionContainer,X=V.$caption,U=X.clone().css("height","auto").hide();W.parent().before(U);W.removeClass("kv-has-ellipsis");if(U.outerWidth()>X.outerWidth()){W.addClass("kv-has-ellipsis")}U.remove()},listen:function(){var V=this,W=V.$element,X=V.$captionContainer,Y=V.$btnFile,U=W.closest("form");W.on("change",A.proxy(V.change,V));A(window).on("resize",function(){V.setEllipsis()});Y.off("click").on("click",function(){V.raise("filebrowse");if(V.isError&&!V.isUploadable){V.clear()}X.focus()});U.off("reset").on("reset",A.proxy(V.reset,V));V.$container.off("click").on("click",".fileinput-remove:not([disabled])",A.proxy(V.clear,V)).on("click",".fileinput-cancel",A.proxy(V.cancel,V));if(V.isUploadable&&V.dropZoneEnabled&&V.showPreview){V.initDragDrop()}if(!V.isUploadable){U.on("submit",A.proxy(V.submitForm,V))}V.$container.find(".kv-fileinput-upload").off("click").on("click",function(ac){var ab=A(this),Z,aa=!ab.hasClass("disabled")&&n(ab.attr("disabled"));if(!V.isUploadable){if(aa&&ab.attr("type")!=="submit"){Z=ab.closest("form");if(Z.length){Z.trigger("submit")}ac.preventDefault()}return}ac.preventDefault();if(aa){V.upload()}})},submitForm:function(){var U=this,V=U.$element,W=V.get(0).files;if(W&&W.length<U.minFileCount&&U.minFileCount>0){U.noFilesError({});return false}return !U.abort({})},abort:function(W){var U=this,V;if(U.ajaxAborted&&typeof U.ajaxAborted==="object"&&U.ajaxAborted.message!==undefined){V=A.extend(U.getOutData(),W);V.abortData=U.ajaxAborted.data||{};V.abortMessage=U.ajaxAborted.message;U.showUploadError(U.ajaxAborted.message,V,"filecustomerror");return true}return false},noFilesError:function(Y){var V=this,W=V.minFileCount>1?V.filePlural:V.fileSingle,X=V.msgFilesTooLess.replace("{n}",V.minFileCount).replace("{files}",W),U=V.$errorContainer;U.html(X);V.isError=true;V.updateFileDetails(0);U.fadeIn(800);V.raise("fileerror",[Y]);V.clearFileInput();k(V.$container,"has-error")},setProgress:function(X){var U=this,W=Math.min(X,100),V=W<100?U.progressTemplate:U.progressCompleteTemplate;if(!n(V)){U.$progress.html(V.repl("{percent}",W))}},upload:function(){var W=this,V=W.getFileStack().length,aa={},Y,Z,U,X=!A.isEmptyObject(W.getExtraData());if(V<W.minFileCount&&W.minFileCount>0){W.noFilesError(aa);return}if(!W.isUploadable||W.isDisabled||(V===0&&!X)){return}W.resetUpload();W.$progress.removeClass("hide");W.uploadCount=0;W.uploadPercent=0;W.lock();W.setProgress(0);if(V===0&&X){W.uploadExtraOnly();return}U=W.filestack.length;W.hasInitData=false;if(W.uploadAsync&&W.showPreview){Z=W.getOutData();W.raise("filebatchpreupload",[Z]);W.fileBatchCompleted=false;W.uploadCache={content:[],config:[],tags:[],append:true};for(Y=0;Y<U;Y+=1){if(W.filestack[Y]!==undefined){W.uploadSingle(Y,W.filestack,true)}}return}W.uploadBatch()},lock:function(){var U=this;U.resetErrors();U.disable();if(U.showRemove){k(U.$container.find(".fileinput-remove"),"hide")}if(U.showCancel){U.$container.find(".fileinput-cancel").removeClass("hide")}U.raise("filelock",[U.filestack,U.getExtraData()])},unlock:function(V){var U=this;if(V===undefined){V=true}U.enable();if(U.showCancel){k(U.$container.find(".fileinput-cancel"),"hide")}if(U.showRemove){U.$container.find(".fileinput-remove").removeClass("hide")}if(V){U.resetFileStack()}U.raise("fileunlock",[U.filestack,U.getExtraData()])},resetFileStack:function(){var U=this,V=0,W=[];U.getThumbs().each(function(){var Z=A(this),Y=Z.attr("data-fileindex"),X=U.filestack[Y];if(Y===-1){return}if(X!==undefined){W[V]=X;Z.attr({id:U.previewInitId+"-"+V,"data-fileindex":V});V+=1}else{Z.attr({id:"uploaded-"+q(),"data-fileindex":"-1"})}});U.filestack=W},refresh:function(V){var U=this,W=U.$element,X,Y=(arguments.length)?A.extend(U.options,V):U.options;W.off();U.init(Y);X=U.$container.find(".file-drop-zone");X.off("dragenter dragover dragleave drop");A(document).off("dragenter dragover drop");U.listen();U.setFileDropZoneTitle()},initDragDrop:function(){var U=this,V=U.$container.find(".file-drop-zone");V.off("dragenter dragover dragleave drop");A(document).off("dragenter dragover drop");V.on("dragenter dragover",function(X){var W=A.inArray("Files",X.originalEvent.dataTransfer.types)>-1;X.stopPropagation();X.preventDefault();if(U.isDisabled||!W){X.originalEvent.dataTransfer.effectAllowed="none";X.originalEvent.dataTransfer.dropEffect="none";return}k(A(this),"highlighted")});V.on("dragleave",function(W){W.stopPropagation();W.preventDefault();if(U.isDisabled){return}A(this).removeClass("highlighted")});V.on("drop",function(W){W.preventDefault();if(U.isDisabled||n(W.originalEvent.dataTransfer.files)){return}U.change(W,"dragdrop");A(this).removeClass("highlighted")});A(document).on("dragenter dragover drop",function(W){W.stopPropagation();W.preventDefault()})},setFileDropZoneTitle:function(){var U=this,V=U.$container.find(".file-drop-zone");V.find("."+U.dropZoneTitleClass).remove();if(!U.isUploadable||!U.showPreview||V.length===0||U.getFileStack().length>0||!U.dropZoneEnabled){return}if(V.find(".file-preview-frame").length===0){V.prepend('<div class="'+U.dropZoneTitleClass+'">'+U.dropZoneTitle+"</div>")}U.$container.removeClass("file-input-new");k(U.$container,"file-input-ajax-new")},initFileActions:function(){var U=this;U.$preview.find(".kv-file-remove").each(function(){var W=A(this),X=W.closest(".file-preview-frame"),Y=X.attr("data-fileindex"),Z,V;W.off("click").on("click",function(){U.cleanMemory(X);X.fadeOut("slow",function(){U.filestack[Y]=undefined;U.clearObjects(X);X.remove();var ac=U.getFileStack(true),aa=ac.length,ab=l.count(U.id);U.clearFileInput();if(aa===0&&ab===0){U.reset()}else{Z=ab+aa;V=Z>1?U.getMsgSelected(Z):(ac[0]?ac[0].name:"");U.setCaption(V)}})})});U.$preview.find(".kv-file-upload").each(function(){var V=A(this);V.off("click").on("click",function(){var W=V.closest(".file-preview-frame"),X=W.attr("data-fileindex");U.uploadSingle(X,U.filestack,false)})})},getMsgSelected:function(W){var U=this,V=W===1?U.fileSingle:U.filePlural;return U.msgSelected.replace("{n}",W).replace("{files}",V)},renderFileFooter:function(V,Z){var U=this,X=U.fileActionSettings,aa,W,Y=U.getLayoutTemplate("footer");if(U.isUploadable){aa=Y.repl("{actions}",U.renderFileActions(true,true,false,false,false));W=aa.repl("{caption}",V).repl("{width}",Z).repl("{indicator}",X.indicatorNew).repl("{indicatorTitle}",X.indicatorNewTitle)}else{W=Y.repl("{actions}","").repl("{caption}",V).repl("{width}",Z).repl("{indicator}","").repl("{indicatorTitle}","")}W=d(W,U.previewThumbTags);return W},renderFileActions:function(X,U,ab,W,ag){if(!X&&!U){return""}var ah=this,aa=W===false?"":' data-url="'+W+'"',Y=ag===false?"":' data-key="'+ag+'"',ac=ah.getLayoutTemplate("actionDelete"),ad="",af=ah.getLayoutTemplate("actions"),V=ah.otherActionButtons.repl("{dataKey}",Y),Z=ah.fileActionSettings,ae=ab?Z.removeClass+" disabled":Z.removeClass;ac=ac.repl("{removeClass}",ae).repl("{removeIcon}",Z.removeIcon).repl("{removeTitle}",Z.removeTitle).repl("{dataUrl}",aa).repl("{dataKey}",Y);if(X){ad=ah.getLayoutTemplate("actionUpload").repl("{uploadClass}",Z.uploadClass).repl("{uploadIcon}",Z.uploadIcon).repl("{uploadTitle}",Z.uploadTitle)}return af.repl("{delete}",ac).repl("{upload}",ad).repl("{other}",V)},setThumbStatus:function(ab,U){var V=this,Y="indicator"+U,aa=Y+"Title",X="file-preview-"+U.toLowerCase(),Z=ab.find(".file-upload-indicator"),W=V.fileActionSettings;ab.removeClass("file-preview-success file-preview-error file-preview-loading");Z.html(W[Y]);Z.attr("title",W[aa]);ab.addClass(X)},clearPreview:function(){var U=this,V=!U.showUploadedThumbs?U.$preview.find(".file-preview-frame"):U.$preview.find(".file-preview-frame:not(.file-preview-success)");V.remove();if(!U.$preview.find(".file-preview-frame").length||!U.showPreview){U.resetUpload()}},initPreview:function(X){var U=this,W=U.initialCaption||"",V;if(!l.count(U.id)){U.clearPreview();if(X){U.setCaption(W)}else{U.initCaption()}return}V=l.out(U.id);W=X&&U.initialCaption?U.initialCaption:V.caption;U.$preview.html(V.content);U.setCaption(W);if(!n(V.content)){U.$container.removeClass("file-input-new")}},initPreviewDeletes:function(){var V=this,U=V.deleteExtraData||{},W=function(){if(V.$preview.find(".kv-file-remove").length===0){V.reset();V.initialCaption=""}};V.$preview.find(".kv-file-remove").each(function(){var ag=A(this),ae=ag.data("url")||V.deleteUrl,Y=ag.data("key");if(n(ae)||Y===undefined){return}var Z=ag.closest(".file-preview-frame"),X=l.data[V.id],ac,ad,af=Z.data("fileindex"),aa,ab;af=parseInt(af.replace("init_",""));aa=n(X.config)&&n(X.config[af])?null:X.config[af];ab=n(aa)||n(aa.extra)?U:aa.extra;if(typeof ab==="function"){ab=ab()}ad={id:ag.attr("id"),key:Y,extra:ab};ac=A.extend({url:ae,type:"DELETE",dataType:"json",data:A.extend({key:Y},ab),beforeSend:function(ah){V.ajaxAborted=false;V.raise("filepredelete",[Y,ah,ab]);if(V.ajaxAborted){ah.abort()}else{k(Z,"file-uploading");k(ag,"disabled")}},success:function(aj,al,ai){var ak,ah;if(n(aj)||n(aj.error)){l.unset(V.id,af);ak=l.count(V.id);ah=ak>0?V.getMsgSelected(ak):"";V.raise("filedeleted",[Y,ai,ab]);V.setCaption(ah)}else{ad.jqXHR=ai;ad.response=aj;V.showError(aj.error,ad,"filedeleteerror");Z.removeClass("file-uploading");ag.removeClass("disabled");W();return}Z.removeClass("file-uploading").addClass("file-deleted");Z.fadeOut("slow",function(){V.clearObjects(Z);Z.remove();W();if(!ak&&V.getFileStack().length===0){V.setCaption("");V.reset()}})},error:function(ai,ak,aj){var ah=V.parseError(ai,aj);ad.jqXHR=ai;ad.response={};V.showError(ah,ad,"filedeleteerror");Z.removeClass("file-uploading");W()}},V.ajaxDeleteSettings);ag.off("click").on("click",function(){A.ajax(ac)})})},clearObjects:function(U){U.find("video audio").each(function(){this.pause();A(this).remove()});U.find("img object div").each(function(){A(this).remove()})},clearFileInput:function(){var W=this,X=W.$element,Y,U,V;if(n(X.val())){return}if(W.isIE9||W.isIE10){Y=X.closest("form");U=A(document.createElement("form"));V=A(document.createElement("div"));X.before(V);if(Y.length){Y.after(U)}else{V.after(U)}U.append(X).trigger("reset");V.before(X).remove();U.remove()}else{X.val("")}W.fileInputCleared=true},resetUpload:function(){var U=this;U.uploadCache={content:[],config:[],tags:[],append:true};U.uploadCount=0;U.uploadPercent=0;U.$btnUpload.removeAttr("disabled");U.setProgress(0);k(U.$progress,"hide");U.resetErrors(false);U.ajaxAborted=false;U.ajaxRequests=[]},cancel:function(){var V=this,X=V.ajaxRequests,U=X.length,W;if(U>0){for(W=0;W<U;W+=1){X[W].abort()}}V.getThumbs().each(function(){var Z=A(this),Y=Z.attr("data-fileindex");Z.removeClass("file-uploading");if(V.filestack[Y]!==undefined){Z.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled");Z.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")}V.unlock()})},cleanMemory:function(V){var U=V.is("img")?V.attr("src"):V.find("source").attr("src");P.revokeObjectURL(U)},hasInitialPreview:function(){var U=this;return !U.overwriteInitial&&l.count(U.id)},clear:function(){var U=this,V;U.$btnUpload.removeAttr("disabled");U.getThumbs().find("video,audio,img").each(function(){U.cleanMemory(A(this))});U.resetUpload();U.filestack=[];U.clearFileInput();U.resetErrors(true);U.raise("fileclear");if(U.hasInitialPreview()){U.showFileIcon();U.resetPreview();U.setEllipsis();U.initPreviewDeletes();U.$container.removeClass("file-input-new")}else{U.getThumbs().each(function(){U.clearObjects(A(this))});U.$preview.html("");V=(!U.overwriteInitial&&U.initialCaption.length>0)?U.initialCaption:"";U.setCaption(V);U.setEllipsis();U.$caption.attr("title","");k(U.$container,"file-input-new")}if(U.$container.find(".file-preview-frame").length===0){if(!U.initCaption()){U.$captionContainer.find(".kv-caption-icon").hide()}U.setEllipsis()}U.hideFileIcon();U.raise("filecleared");U.$captionContainer.focus();U.setFileDropZoneTitle()},resetPreview:function(){var U=this,V;if(l.count(U.id)){V=l.out(U.id);U.$preview.html(V.content);U.setCaption(V.caption)}else{U.clearPreview();U.initCaption()}},reset:function(){var U=this;U.resetPreview();U.setEllipsis();U.$container.find(".fileinput-filename").text("");U.raise("filereset");if(U.initialPreview.length>0){U.$container.removeClass("file-input-new")}U.setFileDropZoneTitle();U.filestack=[];U.formdata={}},disable:function(){var U=this;U.isDisabled=true;U.raise("filedisabled");U.$element.attr("disabled","disabled");U.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled");U.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").attr("disabled",true);U.initDragDrop()},enable:function(){var U=this;U.isDisabled=false;U.raise("fileenabled");U.$element.removeAttr("disabled");U.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled");U.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").removeAttr("disabled");U.initDragDrop()},getThumbs:function(U){U=U||"";return this.$preview.find(".file-preview-frame:not(.file-preview-initial)"+U)},getExtraData:function(){var U=this,V=U.uploadExtraData;if(typeof U.uploadExtraData==="function"){V=U.uploadExtraData()}return V},uploadExtra:function(){var U=this,V=U.getExtraData();if(V.length===0){return}A.each(V,function(W,X){U.formdata.append(W,X)})},initXhr:function(W,V){var U=this;if(W.upload){W.upload.addEventListener("progress",function(Z){var aa=0,X=Z.loaded||Z.position,Y=Z.total;if(Z.lengthComputable){aa=Math.ceil(X/Y*V)}U.uploadPercent=Math.max(aa,U.uploadPercent);U.setProgress(U.uploadPercent)},false)}return W},ajaxSubmit:function(W,Y,Z,V){var U=this,X;U.uploadExtra();X=A.extend({xhr:function(){var aa=A.ajaxSettings.xhr();return U.initXhr(aa,98)},url:U.uploadUrl,type:"POST",dataType:"json",data:U.formdata,cache:false,processData:false,contentType:false,beforeSend:W,success:Y,complete:Z,error:V},U.ajaxSettings);U.ajaxRequests.push(A.ajax(X))},initUploadSuccess:function(X,ad,U){var ab=this,V,Y,Z,ae,aa,W,ac;if(typeof X!=="object"||A.isEmptyObject(X)){return}if(X.initialPreview!==undefined&&X.initialPreview.length>0){ab.hasInitData=true;aa=X.initialPreview||[];W=X.initialPreviewConfig||[];ac=X.initialPreviewThumbTags||[];V=X.append===undefined||X.append?true:false;ab.overwriteInitial=false;if(ad!==undefined&&!U){Z=l.add(ab.id,aa,W[0],ac[0],V);Y=l.get(ab.id,Z,false);ae=A(Y).hide();ad.after(ae).fadeOut("slow",function(){ae.fadeIn("slow").css("display:inline-block");ab.initPreviewDeletes();ab.clearFileInput();ad.remove()})}else{if(U){ab.uploadCache.content.push(aa[0]);ab.uploadCache.config.push(W[0]);ab.uploadCache.tags.push(ac[0]);ab.uploadCache.append=V}else{l.set(ab.id,aa,W,ac,V);ab.initPreview();ab.initPreviewDeletes()}}}},initSuccessThumbs:function(){var U=this;U.getThumbs(".file-preview-success").each(function(){var W=A(this),V=W.find(".kv-file-remove");V.removeAttr("disabled").off("click").on("click",function(){var X=U.raise("filesuccessremove",[W.attr("id"),W.data("fileindex")]);U.cleanMemory(W);if(X===false){return}W.fadeOut("slow",function(){W.remove();if(!U.$preview.find(".file-preview-frame").length){U.reset()}})})})},uploadSingle:function(aj,Z,Y){var ah=this,ao=ah.getFileStack().length,af=new FormData(),an,U=ah.previewInitId+"-"+aj,ac=A("#"+U+":not(.file-preview-initial)"),V,ai,ae=ac.find(".kv-file-upload"),am=ac.find(".kv-file-remove"),ad,X=ah.filestack.length>0||!A.isEmptyObject(ah.uploadExtraData),ag,aa,ab,W,al,ak={id:U,index:aj};ah.formdata=af;if(ao===0||!X||ae.hasClass("disabled")||ah.abort(ak)){return}ai=function(){var ap=ah.getThumbs(".file-uploading");if(ap.length>0||ah.fileBatchCompleted){return}ah.fileBatchCompleted=true;setTimeout(function(){l.set(ah.id,ah.uploadCache.content,ah.uploadCache.config,ah.uploadCache.tags,ah.uploadCache.append);if(ah.hasInitData){ah.initPreview();ah.initPreviewDeletes()}ah.setProgress(100);ah.unlock();ah.clearFileInput();ah.raise("filebatchuploadcomplete",[ah.filestack,ah.getExtraData()])},100)};ad=function(){if(!Y||ao===0||ah.uploadPercent>=100){return}ah.uploadCount+=1;V=80+Math.ceil(ah.uploadCount*20/ao);ah.uploadPercent=Math.max(V,ah.uploadPercent);ah.setProgress(ah.uploadPercent);ah.initPreviewDeletes()};ag=function(){ae.removeAttr("disabled");am.removeAttr("disabled");ac.removeClass("file-uploading")};aa=function(ap){an=ah.getOutData(ap);if(!ac.hasClass("file-preview-success")){ah.setThumbStatus(ac,"Loading");k(ac,"file-uploading")}ae.attr("disabled",true);am.attr("disabled",true);if(!Y){ah.lock()}ah.raise("filepreupload",[an,U,aj]);ak=A.extend(ak,an);if(ah.abort(ak)){ap.abort();ah.setProgress(100)}};ab=function(aq,ar,ap){an=ah.getOutData(ap,aq);ak=A.extend(ak,an);setTimeout(function(){if(n(aq)||n(aq.error)){ah.setThumbStatus(ac,"Success");ae.hide();ah.filestack[aj]=undefined;ah.raise("fileuploaded",[an,U,aj]);ah.initUploadSuccess(aq,ac,Y);if(!Y){ah.resetFileStack()}}else{ah.setThumbStatus(ac,"Error");ah.showUploadError(aq.error,ak)}},100)};W=function(){setTimeout(function(){ad();ag();if(!Y){ah.unlock(false)}else{ai()}ah.initSuccessThumbs()},100)};al=function(aq,at,ar){var ap=ah.parseError(aq,ar,(Y?Z[aj].name:null));ah.setThumbStatus(ac,"Error");ak=A.extend(ak,ah.getOutData(aq));ah.showUploadError(ap,ak)};af.append(ah.uploadFileAttr,Z[aj]);af.append("file_id",aj);ah.ajaxSubmit(aa,ab,W,al)},uploadBatch:function(){var af=this,U=af.filestack,ad=U.length,W,V=af.filestack.length>0||!A.isEmptyObject(af.uploadExtraData),X,ab,aa,ae,Z,ac,Y={};af.formdata=new FormData();if(ad===0||!V||af.abort(Y)){return}X=function(){A.each(U,function(ag){af.filestack[ag]=undefined});af.clearFileInput()};aa=function(ag){af.lock();var ah=af.getOutData(ag);if(af.showPreview){af.getThumbs().each(function(){var ak=A(this),ai=ak.find(".kv-file-upload"),aj=ak.find(".kv-file-remove");if(!ak.hasClass("file-preview-success")){af.setThumbStatus(ak,"Loading");k(ak,"file-uploading")}ai.attr("disabled",true);aj.attr("disabled",true)})}af.raise("filebatchpreupload",[ah]);if(af.abort(ah)){ag.abort()}};ae=function(aj,al,ai){var ak=af.getOutData(ai,aj),ag=af.getThumbs(),ah=n(aj.errorkeys)?[]:aj.errorkeys;if(n(aj)||n(aj.error)){af.raise("filebatchuploadsuccess",[ak]);X();if(af.showPreview){ag.each(function(){var an=A(this),am=an.find(".kv-file-upload");an.find(".kv-file-upload").hide();af.setThumbStatus(an,"Success");an.removeClass("file-uploading");am.removeAttr("disabled")});af.initUploadSuccess(aj)}else{af.reset()}}else{if(af.showPreview){ag.each(function(){var ao=A(this),an=ao.find(".kv-file-remove"),am=ao.find(".kv-file-upload");ao.removeClass("file-uploading");am.removeAttr("disabled");an.removeAttr("disabled");if(ah.length===0){af.setThumbStatus(ao,"Error");return}if(A.inArray(key,ah)!==-1){af.setThumbStatus(ao,"Error")}else{ao.find(".kv-file-upload").hide();af.setThumbStatus(ao,"Success");af.filestack[key]=undefined}});af.initUploadSuccess(aj)}af.showUploadError(aj.error,ak,"filebatchuploaderror")}};Z=function(){af.setProgress(100);af.unlock();af.initSuccessThumbs();af.raise("filebatchuploadcomplete",[af.filestack,af.getExtraData()]);af.clearFileInput()};ac=function(ah,ak,aj){var ai=af.getOutData(ah),ag=af.parseError(ah,aj);af.showUploadError(ag,ai,"filebatchuploaderror");af.uploadFileCount=ad-1;if(!af.showPreview){return}af.getThumbs().each(function(){var am=A(this),al=am.attr("data-fileindex");am.removeClass("file-uploading");if(af.filestack[al]!==undefined){af.setThumbStatus(am,"Error")}});af.getThumbs().removeClass("file-uploading");af.getThumbs(" .kv-file-upload").removeAttr("disabled");af.getThumbs(" .kv-file-delete").removeAttr("disabled")};A.each(U,function(ag,ah){if(!n(U[ag])){af.formdata.append(af.uploadFileAttr,ah)}});af.ajaxSubmit(aa,ae,Z,ac)},uploadExtraOnly:function(){var V=this,Y={},W,X,Z,U;V.formdata=new FormData();if(V.abort(Y)){return}W=function(aa){V.lock();var ab=V.getOutData(aa);V.raise("filebatchpreupload",[ab]);V.setProgress(50);Y.data=ab;Y.xhr=aa;if(V.abort(Y)){aa.abort();V.setProgress(100)}};X=function(ab,ad,aa){var ac=V.getOutData(aa,ab);if(n(ab)||n(ab.error)){V.raise("filebatchuploadsuccess",[ac]);V.clearFileInput();V.initUploadSuccess(ab)}else{V.showUploadError(ab.error,ac,"filebatchuploaderror")}};Z=function(){V.setProgress(100);V.unlock();V.raise("filebatchuploadcomplete",[V.filestack,V.getExtraData()]);V.clearFileInput()};U=function(ab,ae,ad){var ac=V.getOutData(ab),aa=V.parseError(ab,ad);Y.data=ac;V.showUploadError(aa,ac,"filebatchuploaderror")};V.ajaxSubmit(W,X,Z,U)},hideFileIcon:function(){if(this.overwriteInitial){this.$captionContainer.find(".kv-caption-icon").hide()}},showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},resetErrors:function(W){var V=this,U=V.$errorContainer;V.isError=false;V.$container.removeClass("has-error");U.html("");if(W){U.fadeOut("slow")}else{U.hide()}},showFolderError:function(W){var V=this,U=V.$errorContainer;if(!W){return}U.html(V.msgFoldersNotAllowed.repl("{n}",W));U.fadeIn(800);k(V.$container,"has-error");V.raise("filefoldererror",[W])},showUploadError:function(Z,Y,X){var V=this,U=V.$errorContainer,W=X||"fileuploaderror";if(U.find("ul").length===0){U.html("<ul><li>"+Z+"</li></ul>")}else{U.find("ul").append("<li>"+Z+"</li>")}U.fadeIn(800);V.raise(W,[Y]);k(V.$container,"has-error");return true},showError:function(Z,Y,X){var V=this,U=V.$errorContainer,W=X||"fileerror";Y=Y||{};Y.reader=V.reader;U.html(Z);U.fadeIn(800);V.raise(W,[Y]);if(!V.isUploadable){V.clearFileInput()}k(V.$container,"has-error");V.$btnUpload.attr("disabled",true);return true},errorHandler:function(U,W){var V=this,X=U.target.error;switch(X.code){case X.NOT_FOUND_ERR:V.showError(V.msgFileNotFound.replace("{name}",W));break;case X.SECURITY_ERR:V.showError(V.msgFileSecured.replace("{name}",W));break;case X.NOT_READABLE_ERR:V.showError(V.msgFileNotReadable.replace("{name}",W));break;case X.ABORT_ERR:V.showError(V.msgFilePreviewAborted.replace("{name}",W));break;default:V.showError(V.msgFilePreviewError.replace("{name}",W))}},parseFileType:function(X){var V=this,Z,Y,U,W;for(W=0;W<N.length;W+=1){U=N[W];Z=E(U,V.fileTypeSettings)?V.fileTypeSettings[U]:O[U];Y=Z(X.type,X.name)?U:"";if(!n(Y)){return Y}}return"other"},previewDefault:function(Y,aa,ac){if(!this.showPreview){return}var ae=this,Z=P.createObjectURL(Y),U=A("#"+aa),W=ae.previewSettings.other||R.other,ab=ae.renderFileFooter(Y.name,W.width),X=ae.getPreviewTemplate("other"),V=aa.slice(aa.lastIndexOf("-")+1),ad="";if(ac===true){ad=" btn disabled";ab+='<div class="file-other-error text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i></div>'}ae.$preview.append("\n"+X.repl("{previewId}",aa).repl("{frameClass}",ad).repl("{fileindex}",V).repl("{caption}",ae.slug(Y.name)).repl("{width}",W.width).repl("{height}",W.height).repl("{type}",Y.type).repl("{data}",Z).repl("{footer}",ab))},previewFile:function(ak,an,ai,X,aq){if(!this.showPreview){return}var ae=this,Z=ae.parseFileType(an),am=ae.slug(an.name),aj,ao,ac=ae.allowedPreviewTypes,W=ae.allowedPreviewMimeTypes,U=ae.getPreviewTemplate(Z),ap=E(Z,ae.previewSettings)?ae.previewSettings[Z]:R[Z],ab=parseInt(ae.wrapTextLength,10),V=ae.wrapIndicator,af=ac.indexOf(Z)>=0,ah,ad,Y=n(W)||(!n(W)&&W.indexOf(an.type)!==-1),ag=ae.renderFileFooter(am,ap.width),al="",aa=X.slice(X.lastIndexOf("-")+1);if(af&&Y){if(Z==="text"){ao=p(ai.target.result);if(ao.length>ab){ah="text-"+q();ad=window.innerHeight*0.75;al=ae.getLayoutTemplate("modal").repl("{id}",ah).repl("{title}",am).repl("{height}",ad).repl("{body}",ao);V=V.repl("{title}",am).repl("{dialog}","$('#"+ah+"').modal('show')");ao=ao.substring(0,(ab-1))+V}aj=U.repl("{previewId}",X).repl("{caption}",am).repl("{frameClass}","").repl("{type}",an.type).repl("{width}",ap.width).repl("{height}",ap.height).repl("{data}",ao).repl("{footer}",ag).repl("{fileindex}",aa)+al}else{aj=U.repl("{previewId}",X).repl("{caption}",am).repl("{frameClass}","").repl("{type}",an.type).repl("{data}",aq).repl("{width}",ap.width).repl("{height}",ap.height).repl("{footer}",ag).repl("{fileindex}",aa)}ae.$preview.append("\n"+aj);ae.validateImage(ak,X)}else{ae.previewDefault(an,X)}},slugDefault:function(U){return n(U)?"":U.split(/(\\|\/)/g).pop().replace(/[^\w\u00C0-\u017F\-.\\\/ ]+/g,"")},getFileStack:function(V){var W=this,U;return W.filestack.filter(function(X){return(V?X!==undefined:X!==undefined&&X!==null)})},readFiles:function(U){this.reader=new FileReader();var ah=this,ai=ah.$element,aa=ah.$preview,ac=ah.reader,af=ah.$previewContainer,ag=ah.$previewStatus,ad=ah.msgLoading,W=ah.msgProgress,ab=ah.previewInitId,V=U.length,Z=ah.fileTypeSettings,X=ah.filestack.length,Y=function(ao,al,aj,ak){var an=A.extend(ah.getOutData({},{},U),{id:aj,index:ak}),am={id:aj,index:ak,file:al,files:U};ah.previewDefault(al,aj,true);return ah.isUploadable?ah.showUploadError(ao,an):ah.showError(ao,am)};function ae(ax){if(n(ai.attr("multiple"))){V=1}if(ax>=V){if(ah.isUploadable&&ah.filestack.length>0){ah.raise("filebatchselected",[ah.getFileStack()])}else{ah.raise("filebatchselected",[U])}af.removeClass("loading");ag.html("");return}var au=X+ax,ak=ab+"-"+au,at,aA=U[ax],ay=ah.slug(aA.name),ar=(aA.size||0)/1000,an,al="",ap=P.createObjectURL(aA),aB=0,aw,ao,aC,az,aj=ah.allowedFileTypes,av=n(aj)?"":aj.join(", "),aq=ah.allowedFileExtensions,am=n(aq)?"":aq.join(", ");if(!n(aq)){al=new RegExp("\\.("+aq.join("|")+")$","i")}ar=ar.toFixed(2);if(ah.maxFileSize>0&&ar>ah.maxFileSize){ao=ah.msgSizeTooLarge.replace("{name}",ay).replace("{size}",ar).replace("{maxSize}",ah.maxFileSize);ah.isError=Y(ao,aA,ak,ax);return}if(!n(aj)&&t(aj)){for(aw=0;aw<aj.length;aw+=1){aC=aj[aw];an=Z[aC];az=(an!==undefined&&an(aA.type,ay));aB+=n(az)?0:az.length}if(aB===0){ao=ah.msgInvalidFileType.replace("{name}",ay).replace("{types}",av);ah.isError=Y(ao,aA,ak,ax);return}}if(aB===0&&!n(aq)&&t(aq)&&!n(al)){az=ay.match(al);aB+=n(az)?0:az.length;if(aB===0){ao=ah.msgInvalidFileExtension.replace("{name}",ay).replace("{extensions}",am);ah.isError=Y(ao,aA,ak,ax);return}}if(!ah.showPreview){ah.filestack.push(aA);setTimeout(ae(ax+1),100);ah.raise("fileloaded",[aA,ak,ax,ac]);return}if(aa.length>0&&FileReader!==undefined){ag.html(ad.replace("{index}",ax+1).replace("{files}",V));af.addClass("loading");ac.onerror=function(aD){ah.errorHandler(aD,ay)};ac.onload=function(aD){ah.previewFile(ax,aA,aD,ak,ap);ah.initFileActions()};ac.onloadend=function(){ao=W.replace("{index}",ax+1).replace("{files}",V).replace("{percent}",50).replace("{name}",ay);setTimeout(function(){ag.html(ao);ae(ax+1);ah.updateFileDetails(V)},100);ah.raise("fileloaded",[aA,ak,ax,ac])};ac.onprogress=function(aF){if(aF.lengthComputable){var aE=(aF.loaded/aF.total)*100,aD=Math.ceil(aE);ao=W.replace("{index}",ax+1).replace("{files}",V).replace("{percent}",aD).replace("{name}",ay);setTimeout(function(){ag.html(ao)},100)}};at=E("text",Z)?Z.text:O.text;if(at(aA.type,ay)){ac.readAsText(aA,ah.textEncoding)}else{ac.readAsArrayBuffer(aA)}}else{ah.previewDefault(aA,ak);setTimeout(function(){ae(ax+1);ah.updateFileDetails(V)},100);ah.raise("fileloaded",[aA,ak,ax,ac])}ah.filestack.push(aA)}ae(0);ah.updateFileDetails(V,false)},updateFileDetails:function(V){var ab=this,ac=ab.$element,Y=ab.getFileStack(),U=ac.val()||(Y.length&&Y[0].name)||"",aa=ab.slug(U),W=ab.isUploadable?Y.length:V,Z=l.count(ab.id)+W,X=W>1?ab.getMsgSelected(Z):aa;if(ab.isError){ab.$previewContainer.removeClass("loading");ab.$previewStatus.html("");ab.$captionContainer.find(".kv-caption-icon").hide()}else{ab.showFileIcon()}ab.setCaption(X,ab.isError);ab.$container.removeClass("file-input-new file-input-ajax-new");if(arguments.length===1){ab.raise("fileselect",[V,aa])}if(l.count(ab.id)){ab.initPreviewDeletes()}},change:function(ai){var ab=this,ak=ab.$element;if(!ab.isUploadable&&n(ak.val())&&ab.fileInputCleared){ab.fileInputCleared=false;return}ab.fileInputCleared=false;var Z,V,al,aa=ab.$preview,X=arguments.length>1,W=X?ai.originalEvent.dataTransfer.files:ak.get(0).files,Y=n(ak.attr("multiple")),ae=0,ag,ac,af=0,ah=ab.filestack.length,U=ab.isUploadable,aj=function(am,ap,an,ao){var ar=A.extend(ab.getOutData({},{},W),{id:an,index:ao}),aq={id:an,index:ao,file:ap,files:W};return ab.isUploadable?ab.showUploadError(am,ar):ab.showError(am,aq)};ab.reader=null;ab.resetUpload();ab.hideFileIcon();if(ab.isUploadable){ab.$container.find(".file-drop-zone ."+ab.dropZoneTitleClass).remove()}if(X){Z=[];while(W[ae]){ag=W[ae];if(!ag.type&&ag.size%4096===0){af++}else{Z.push(ag)}ae++}}else{if(ai.target.files===undefined){Z=ai.target&&ai.target.value?[{name:ai.target.value.replace(/^.+\\/,"")}]:[]}else{Z=ai.target.files}}if(n(Z)||Z.length===0){if(!U){ab.clear()}ab.showFolderError(af);ab.raise("fileselectnone");return}ab.resetErrors();al=ab.isUploadable?ab.getFileStack().length+Z.length:Z.length;if(ab.maxFileCount>0&&al>ab.maxFileCount){V=ab.msgFilesTooMany.replace("{m}",ab.maxFileCount).replace("{n}",al);ab.isError=aj(V,null,null,null);ab.$captionContainer.find(".kv-caption-icon").hide();ab.setCaption("",true);ab.setEllipsis();ab.$container.removeClass("file-input-new file-input-ajax-new");return}if(!U||(Y&&ah>0)){if(ab.hasInitialPreview()){var ad=l.out(ab.id);aa.html(ad.content);ab.setCaption(ad.caption);ab.initPreviewDeletes()}else{ab.clearPreview()}if(Y&&ah>0){ab.filestack=[]}}else{if(U&&ah===0&&(!l.count(ab.id)||ab.overwriteInitial)){ab.clearPreview();ab.filestack=[]}}if(ab.isPreviewable){ab.readFiles(Z)}else{ab.updateFileDetails(1)}ab.showFolderError(af)},validateImage:function(Y,ac){var ad=this,X=ad.$preview,W,aa,Z,ab,ae=X.find("#"+ac),V="Untitled",U=ae.find("img");if(!U.length){return}U.on("load",function(){aa=ae.width();Z=X.width();if(aa>Z){U.css("width","100%");ae.css("width","97%")}ab=U.closest(".file-preview-frame").find(".file-caption-name");if(ab.length){ab.width(U.width());V=ab.text();ab.attr("title",V)}W={ind:Y,id:ac};ad.checkDimensions(Y,"Small",U,ae,V,"Width",W);ad.checkDimensions(Y,"Small",U,ae,V,"Height",W);ad.checkDimensions(Y,"Large",U,ae,V,"Width",W);ad.checkDimensions(Y,"Large",U,ae,V,"Height",W);ad.raise("fileimageloaded",[ac]);P.revokeObjectURL(U.attr("src"))})},checkDimensions:function(aa,ad,U,ah,X,ac,Z){var af=this,W,ab,ag=ad==="Small"?"min":"max",Y=af[ag+"Image"+ac],V,ae;if(n(Y)||!U.length){return}V=U[0];ab=(ac==="Width")?V.naturalWidth||V.width:V.naturalHeight||V.height;ae=ad==="Small"?ab>=Y:ab<=Y;if(ae){return}W=af["msgImage"+ac+ad].replace("{name}",X).replace("{size}",Y);af.showUploadError(W,Z);af.setThumbStatus(ah,"Error");af.filestack[aa]=null},initCaption:function(){var U=this,V=U.initialCaption||"";if(U.overwriteInitial||n(V)){U.$caption.html("");return false}U.setCaption(V);return true},setCaption:function(X,W){var U=this,Y,V;if(W){Y=A("<div>"+U.msgValidationError+"</div>").text();V='<span class="'+U.msgValidationErrorClass+'">'+U.msgValidationErrorIcon+Y+"</span>"}else{if(n(X)||U.$caption.length===0){return}Y=A("<div>"+X+"</div>").text();V=U.getLayoutTemplate("icon")+Y}U.$caption.html(V);U.$caption.attr("title",Y);U.$captionContainer.find(".file-caption-ellipsis").attr("title",Y);U.setEllipsis()},initBrowse:function(V){var U=this;U.$btnFile=V.find(".btn-file");U.$btnFile.append(U.$element)},createContainer:function(){var U=this,V=A(document.createElement("span")).attr({"class":"file-input file-input-new"}).html(U.renderMain());U.$element.before(V);U.initBrowse(V);return V},refreshContainer:function(){var U=this,V=U.$container;V.before(U.$element);V.html(U.renderMain());U.initBrowse(V)},renderMain:function(){var V=this,X=(V.isUploadable&&V.dropZoneEnabled)?" file-drop-zone":"",Y=V.showPreview?V.getLayoutTemplate("preview").repl("{class}",V.previewClass).repl("{dropClass}",X):"",W=V.isDisabled?V.captionClass+" file-caption-disabled":V.captionClass,U=V.captionTemplate.repl("{class}",W+" kv-fileinput-caption");return V.mainTemplate.repl("{class}",V.mainClass).repl("{preview}",Y).repl("{caption}",U).repl("{upload}",V.renderUpload()).repl("{remove}",V.renderRemove()).repl("{cancel}",V.renderCancel()).repl("{browse}",V.renderBrowse())},renderBrowse:function(){var V=this,W=V.browseClass+" btn-file",U="";if(V.isDisabled){U=" disabled "}return'<div class="'+W+'"'+U+"> "+V.browseIcon+V.browseLabel+" </div>"},renderRemove:function(){var V=this,W=V.removeClass+" fileinput-remove fileinput-remove-button",U="";if(!V.showRemove){return""}if(V.isDisabled){U=" disabled "}return'<button type="button" title="'+V.removeTitle+'" class="'+W+'"'+U+">"+V.removeIcon+V.removeLabel+"</button>"},renderCancel:function(){var U=this,V=U.cancelClass+" fileinput-cancel fileinput-cancel-button";if(!U.showCancel){return""}return'<button type="button" title="'+U.cancelTitle+'" class="hide '+V+'">'+U.cancelIcon+U.cancelLabel+"</button>"},renderUpload:function(){var V=this,W=V.uploadClass+" kv-fileinput-upload fileinput-upload-button",X="",U="";if(!V.showUpload){return""}if(V.isDisabled){U=" disabled "}if(!V.isUploadable||V.isDisabled){X='<button type="submit" title="'+V.uploadTitle+'"class="'+W+'"'+U+">"+V.uploadIcon+V.uploadLabel+"</button>"}else{X='<a href="'+V.uploadUrl+'" title="'+V.uploadTitle+'" class="'+W+'"'+U+">"+V.uploadIcon+V.uploadLabel+"</a>"}return X}};A.fn.fileinput=function(V){if(!s()&&!i(9)){return}var U=Array.apply(null,arguments);U.shift();return this.each(function(){var Z=A(this),X=Z.data("fileinput"),Y,W=typeof V==="object"&&V,aa=W.language||Z.data("language")||"en";if(!X){Y=A.extend({},A.fn.fileinput.defaults);if(aa!=="en"&&!n(A.fn.fileinputLocales[aa])){Y=A.extend(Y,A.fn.fileinputLocales[aa])}X=new j(this,A.extend(Y,W,Z.data()));Z.data("fileinput",X)}if(typeof V==="string"){X[V].apply(X,U)}})};A.fn.fileinput.defaults={language:"en",showCaption:true,showPreview:true,showRemove:false,showUpload:false,showCancel:false,showUploadedThumbs:true,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:true,deleteUrl:"",deleteExtraData:{},overwriteInitial:true,layoutTemplates:a,previewTemplates:K,allowedPreviewTypes:N,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,customLayoutTags:{},customPreviewTags:{},previewSettings:R,fileTypeSettings:O,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',browseIcon:'<i class="glyphicon glyphicon-folder-open"></i> &nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i> ',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i> ',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i> ',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:true,uploadExtraData:{},minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,maxFileSize:0,minFileCount:0,maxFileCount:0,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",previewFileType:"image",wrapTextLength:250,wrapIndicator:' <span class="wrap-indicator" title="{title}" onclick="{dialog}">[&hellip;]</span>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,slugCallback:null,dropZoneEnabled:true,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:true};A.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>. Please retry your upload!',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload. Please retry your upload!",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>. Please retry your upload!",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgValidationError:"File Upload Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',dropZoneTitle:"Drag & drop files here &hellip;"};A.extend(A.fn.fileinput.defaults,A.fn.fileinputLocales.en);A.fn.fileinput.Constructor=j;A(document).ready(function(){var U=A("input.file[type=file]");if(U.length){U.fileinput()}})})(window.jQuery);