<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/fileinput.min.css" rel="stylesheet"/>
    <link href="static/css/common.min.css" rel="stylesheet"/>
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="static/js/fileinput.min.js"></script>
    <script src="static/js/common.min.js"></script>
    <script src="https://gosspublic.alicdn.com/aliyun-oss-sdk-6.0.0.min.js"></script>
    <title>前端图床</title>
</head>
<body>
<nav class="navbar navbar-default navbar-inverse navbar-fixed-top">
    <div class="container">
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="index.html">前端图床</a></li>
                <li><a href="config.html">配置</a></li>
            </ul>
        </div>
    </div>
</nav>
<div class="container kv-main">
    <div class="page-header">
        <h1>Image Upload</h1>
    </div>
    <form enctype="multipart/form-data">
        <div class="form-group">
            <input id="smfile" type="file" multiple class="file" accept="image/*">
        </div>
    </form>
    <script type="text/javascript" src="static/js/purify.min.js"></script>
    <script>
        if (checkConfig()) {
            document.getElementById('smfile').addEventListener('change', function (e) {
                $('.alert').remove();
                for (let i = 0; i < e.target.files.length; i++) {
                    let file = e.target.files[i];
                    // let newname = getNewname(file);
                    let time = new Date().getTime();
                    let client = new OSS({
                        region: $.cookie('region'),
                        accessKeyId: $.cookie('accessKeyId'),
                        accessKeySecret: $.cookie('accessKeySecret'),
                        bucket: $.cookie('bucket'),
                        secure: true
                    });
                    $(".kv-main").append('<div class="alert alert-info" id="' + time.toString() + '">\n' +
                        '        <a href="#" class="close" data-dismiss="alert"></a>\n' +
                        '        <strong>正在上传文件：' + file.name + '</strong>\n' +
                        '    </div>');
                    client.multipartUpload(getDate() + '/' + file.name, file).then(function () {
                        $('#' + time.toString()).remove();
                        $(".kv-main").append('<div class="alert alert-success">\n' +
                            '        <a href="#" class="close" data-dismiss="alert"></a>\n' +
                            '        <strong>' + file.name + ' 上传成功</strong>\n' +
                            '    </div>');
                    }).catch(function (err) {
                        $('#' + time.toString()).remove();
                        $(".kv-main").append('<div class="alert alert-danger">\n' +
                            '        <a href="#" class="close" data-dismiss="alert"></a>\n' +
                            '        <strong>上传失败！ ' + err + '</strong>\n' +
                            '    </div>');
                    });
                }
            });
        }
    </script>
</div>
<footer class="footer">
    <div class="container">
        <p class="text-muted">Copyright &#9400; 2019 </p>
    </div>
</footer>
</body>
</html>
